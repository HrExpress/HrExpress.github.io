<!DOCTYPE html>
<html lang="ru">
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Организация</title>
	<link href="/HrExpress.ico" rel="shortcut icon" type="image/x-icon" />
	<link href="/Content/Normal.css" rel="stylesheet" />
</head>
<body id="broot">

	<!-- header -->

	<nav>
		<div class="logo">
			<a href="/">Ex5  press</a>
		</div>
		<div class="hr"></div>

		<ul>
			<li><a href="/Companies.html">Компании</a></li>
			<li><a href="/Requests.html">Запросы</a></li>
			<li><a href="/Vacancies.html">Вакансии</a></li>
			<li><a href="/Candidates.html">Кандидаты</a></li>
		</ul>
		<div class="hr"></div>
		<ul>
			<li data-bind="with: User"><a data-bind="text: Name, attr:{href:'/User.html?'+ID}"></a></li>
			<li><a id="logout" href="#" data-bind="click: Logout">Выйти</a></li>
		</ul>

	</nav>

	<!-- header -->
	<main data-bind="with: PageViewModel">
		<header>
			<h1 class="navbar-brand" href="#">К2омп8ания</h1>
			<button data-bind="click:Save, visible: IsDirty">Сохранить</button>
			<button class="danger" data-bind="click:Delete, visible: !IsCreateMode()">Удалить</button>
		</header>

		<div class="content">
			<div data-bind="with: Company">
				<div id="companyTabs">
					<ul class="tabs-header">
						<li class="active" data-target="home">Название</li>
						<li data-target="profile">Реквизиты</li>
						<li data-bind="visible: !$parent.IsCreateMode()" data-target="workgroup">Проектная группа</li>
						<li data-bind="visible: !$parent.IsCreateMode()" data-target="files">Файлы</li>
						<li data-bind="visible: !$parent.IsCreateMode()" data-target="requests">Запросы</li>
						<li data-bind="visible: !$parent.IsCreateMode()" data-target="vacancies">Вакансии</li>
					</ul>
					<div class="tabs-container">
						<section id="home" class="tab-pane active">
							<div>
								<form class="container">
									<div class="row">
										<span class="col-2 control-label">Название</span>
										<div class="col-10">
											<input type="text" data-bind="textInput: Name" name="CompanyName">
										</div>
									</div>
									<div class="row">
										<span class="col-2 control-label">Описание</span>
										<div class="col-10">
											<input type="text" data-bind="textInput: Description" name="Description">
										</div>
									</div>
									<div class="row">
										<span class="col-2 control-label">Адрес</span>
										<div class="col-10">
											<input type="text" data-bind="textInput: Address" name="Address">
										</div>
									</div>
									<div class="row">
										<span class="col-2 control-label">Телефон</span>
										<div class="col-4">
											<input type="text" data-bind="textInput: Phone" name="Phone">
										</div>
										<span class="col-2 control-label">Электронная почта</span>
										<div class="col-4">
											<input type="text" data-bind="textInput: Email" name="CompanyEmail">
										</div>
									</div>
									<div class="row">
										<span class="col-2 control-label">Интернет</span>
										<div class="col-10">
											<input type="text" data-bind="textInput: Url" name="Url">
										</div>
									</div>
								</form>
							</div>
						</section>

						<section id="profile" class="tab-pane">
							<div>
								<form class="container">
									<div class="row">
										<span class="col-2 control-label">Организационно-правовая форма</span>
										<div class="col-10">
											<input type="text" data-bind="textInput: LegalForm" name="LegalForm">
										</div>
									</div>
									<div class="row">
										<span class="col-2 control-label">Юридический адрес</span>
										<div class="col-10">
											<input type="text" data-bind="textInput: LegalAddress" name="LegalAddress">
										</div>
									</div>

									<div class="row">
										<span class="col-2 control-label">ФИО представителя</span>
										<div class="col-4">
											<input type="text">
										</div>
										<span class="col-2 control-label">ФИО в род.падеже</span>
										<div class="col-4">
											<input type="text" class="form-control">
										</div>
									</div>

									<div class="row">
										<span class="col-2 control-label">Должность представителя</span>
										<div class="col-4">
											<input type="text">
										</div>
										<span class="col-2 control-label">Должность  в род.падеже</span>
										<div class="col-4">
											<input type="text" class="form-control">
										</div>
									</div>

									<div class="row">
										<span class="col-2 control-label">Действует на основании</span>
										<div class="col-10">
											<input type="text">
										</div>
									</div>

									<div class="row">
										<span class="col-2 control-label">Название банка</span>
										<div class="col-10">
											<input type="text" data-bind="textInput: Bank" name="Bank">
										</div>
									</div>

									<div class="row">
										<span class="col-2 control-label">к/с</span>
										<div class="col-4">
											<input type="text" data-bind="textInput: KS" name="KS">
										</div>
										<span class="col-2 control-label">ИНН</span>
										<div class="col-4">
											<input type="text" data-bind="textInput: TIN" name="CompanyTIN">
										</div>
									</div>

									<div class="row">
										<span class="col-2 control-label">р/с</span>
										<div class="col-4">
											<input type="text" data-bind="textInput: RS" name="RS">
										</div>
										<span class="col-2 control-label">БИК</span>
										<div class="col-4">
											<input type="text" data-bind="textInput: BIC" name="BIC">
										</div>
									</div>

									<div class="row">
										<span class="col-2 control-label">ОКВЭД</span>
										<div class="col-4">
											<input type="text">
										</div>
										<span class="col-2 control-label">КПП</span>
										<div class="col-4">
											<input type="text" data-bind="textInput: KPP" name="KPP">
										</div>
									</div>

									<div class="row">
										<span class="col-2 control-label">ОКПО</span>
										<div class="col-4">
											<input type="text">
										</div>
										<span class="col-2 control-label">ОГРН</span>
										<div class="col-4">
											<input type="text" data-bind="textInput: OGRN" name="OGRN">
										</div>
									</div>

									<div class="row">
										<span class="col-2 control-label">Дата внесения записи в ЕГРЮЛ</span>
										<div class="col-4">
											<input type="text">
										</div>
									</div>
								</form>
							</div>
						</section>

						<section id="workgroup" class="tab-pane">
							<ul class="inner-toolbar">
								<li><button data-bind="click: $parent.AddWorkgroup">Добавить пользователя</button></li>
							</ul>
							<table>
								<thead>
									<tr>
										<th class="col-3">Пользователь</th>
										<th class="col-2">Роль</th>
										<th class="col-1">Участие</th>
										<th class="col-6"></th>
									</tr>
								</thead>
								<tbody>
									<!-- ko foreach: $parent.Workgroup -->
									<tr>
										<td><a data-bind="text: $parents[1].GetDisplay('User', UserId), attr: {href: '/User.html?' + UserId()}"></a></td>
										<td data-bind="text: $parents[1].GetDisplay('Role', Role)"></td>
										<td data-bind="text: Percent"></td>
										<td><button data-bind="click: $parents[1].EditWorkgroup" class="lite">изменить</button> <button data-bind="click: $parents[1].DeleteWorkgroup" class="lite">удалить</button></td>
									</tr>									
									<!-- /ko -->

								</tbody>
							</table>
							<!-- ko if: $parent.Workgroup().length == 0 -->
							<p class="placeholder">Тут пусто.</p>
							<!-- /ko -->
							<div class="alert" style="display:none">Суммарный процент участия не равен 100</div>
						</section>

						<section id="files" class="tab-pane">
							<table>
								<thead>
									<tr>
										<th class="col-3">Название</th>
										<th class="col-2">Размер</th>
										<th class="col-3">Загружено</th>
										<th class="col-3"></th>
										<th class="col-1"></th>
									</tr>
								</thead>
								<tbody>
									<!-- ko foreach: $parent.Files -->
									<tr>
										<td><a href="#" data-bind="text: Name, attr: { href:'/File.html?' + ID }"></a></td>
										<td><span data-bind="text: Size"></span></td>
										<td><span data-bind="text: Date"></span></td>
										<td></td>
										<td><button data-bind="click: $parents[1].DeleteFile" class="lite">удалить</button></td>
									</tr>
									<!-- /ko -->
								</tbody>
							</table>
							<!-- ko if: $parent.Files().length == 0 -->
							<p class="placeholder">Тут пусто.</p>
							<!-- /ko -->

							<div class="row">
								<span class="col-2 control-label">Добавить файл</span>
								<div class="col-4">
									<input type="file" class="control" id="selectedFile" />
								</div>
								<div class="col-2">
									<button data-bind="click: $parent.UploadFile">Загрузить</button>
								</div>
							</div>
						</section>

						<section id="requests" class="tab-pane">
							<ul class="inner-toolbar">
								<li><button data-bind="click: $parent.CreateRequest">Новый запрос</button></li>
							</ul>
							<table>
								<thead>
									<tr>
										<th class="col-3">Название</th>
										<th class="col-2"></th>
										<th class="col-1"></th>
										<th class="col-6"></th>
									</tr>
								</thead>
								<tbody>
									<!-- ko foreach: $parent.Requests -->
									<tr>
										<td><a href="#" data-bind="text: Name, attr: { href:'/Request.html?' + ID }"></a></td>
										<td><span data-bind="text: Text"></span></td>
										<td><span data-bind="text: Contacts"></span></td>
										<td></td>
									</tr>
									<!-- /ko -->
								</tbody>
							</table>
							<!-- ko if: $parent.Requests().length == 0 -->
							<p class="text-danger text-center">Тут пусто.</p>
							<!-- /ko -->
						</section>

						<section id="vacancies" class="tab-pane">
							<ul class="inner-toolbar">
								<li><button data-bind="click: $parent.CreateVacancy">Новая вакансия</button></li>
							</ul>
							<table>
								<thead>
									<tr>
										<th class="col-3">Название</th>
										<th class="col-2">З/п</th>
										<th class="col-1">Приоритет</th>
										<th class="col-6">Код</th>
									</tr>
								</thead>
								<tbody>
									<!-- ko foreach: $parent.Vacancies -->
									<tr>
										<td><a href="#" data-bind="text: Name, attr: { href:'/Vacancy.html?' + ID }"></a></td>
										<td><span data-bind="text: Salary"></span></td>
										<td><span data-bind="text: Priority"></span></td>
										<td><span data-bind="text: Code"></span></td>
									</tr>
									<!-- /ko -->
								</tbody>
							</table>
							<!-- ko if: $parent.Vacancies().length == 0 -->
							<p class="text-danger text-center">Тут пусто.</p>
							<!-- /ko -->
						</section>
					</div>
				</div>
			</div>

			<br />
			<br />

			<section id="journalContainer" class="card" data-bind="visible: !IsCreateMode()">
				<h3>
					Журнал
					<button class="pull-right" data-bind="click: ShowJournalForm, visible: !IsJournalFormShown()">добавить сообщение</button>
				</h3>
				<div class="container" style="display: none" data-bind="visible: IsJournalFormShown">
					<div class="row">
						<div class="col-10" data-bind="with: NewJournalItem">
							<textarea placeholder="введите текст сообщения..." rows="4" data-bind="textInput: Content"></textarea>
						</div>
						<div class="col-2">
							<button data-bind="click: SubmitJournal">Отправить</button>
						</div>
					</div>
				</div>
				<div class="content">
					<ul class="group">
						<!-- ko foreach: Journal -->
						<!-- ko if: IsMessage -->
						<li>
							<span class="muted" data-bind="text: app.FormatDate(Date, true)"></span>
							<span data-bind="text: UserName"></span>
							<span class="muted">написал(а)</span>
							<span data-bind="text: Content"></span>
						</li>
						<!-- /ko -->
						<!-- ko ifтще: IsMessage -->
						<li>
							<span class="muted" data-bind="text: app.FormatDate(Date, true)"></span>
							<span data-bind="text: UserName"></span>
							<span class="muted">:</span>
							<span data-bind="text: Content"></span>
						</li>
						<!-- /ko -->
						<!-- /ko -->
					</ul>
				</div>
			</section>
		</div>
	</main>

	<!-- footer -->

	<footer>
		&copy; 2018
		<!--<div data-bind="text: ko.toJSON(app.ViewModel)"></div>-->
	</footer>

	<!-- footer -->

	<section>

		<!-- edit workgroup entry modal -->
		<div class="modalo" data-bind="allowBindings: false">
			<section id="edit-workgroup-modalo" style="display:none">
				<header>
					<h3>Участник группы</h3>
				</header>
				<div class="content">
					<form class="container" data-bind="with: CurrentItem">
						<div class="row">
							<span class="col-4 control-label">Пользователь</span>
							<div class="col-8">
								<select data-bind="value:UserId, options: $parent.Users, optionsValue:'ID',  optionsText: 'Display', optionsCaption:''"></select>
							</div>
						</div>
						<div class="row">
							<span class="col-4 control-label">или его код</span>
							<div class="col-8">
								<input type="text" data-bind="textInput: $parent.UserCode">
							</div>
						</div>
						<div class="row">
							<span class="col-4 control-label">Роль</span>
							<div class="col-8">
								<select data-bind="value:Role, options: $parent.Roles, optionsValue:'ID', optionsText: 'Display'"></select>
							</div>
						</div>
						<div class="row">
							<span class="col-4 control-label">Процент участия</span>
							<div class="col-8">
								<input type="text" data-bind="textInput: Percent" name="Address">
							</div>
						</div>
						<p id="workgroupErrorMessage" class="text-danger text-center" style="padding-top: 16px; display:none;"></p>
					</form>
				</div>
				<footer>
					<button data-bind="click: Close" class="aux">Отмена</button>
					<button data-bind="click: Done">Ok</button>
				</footer>
			</section>
		</div>

		<!-- confirm delete workgroup modal -->
		<div class="modalo" data-bind="allowBindings: false">
			<section id="confirmDeleteWorkgroupModalo" style="display:none">
				<header>
					<h3>Подверждение действия</h3>
				</header>
				<div class="content">
					Эта запись будет удалена.
					<p class="text-muted">Пользователь может потерять доступ к этой компании и её вакансиям.</p>
				</div>
				<footer>
					<button data-bind="click: Close" class="aux">Отмена</button>
					<button data-bind="click: Done" class="danger">Ok</button>
				</footer>
			</section>
		</div>

		<!-- confirm delete company modal -->
		<div class="modalo" data-bind="allowBindings: false">
			<section id="confirm-delete-company-modalo" style="display:none">
				<header>
					<h3>Подверждение действия</h3>
				</header>
				<div class="content">
					Эта организация - <strong data-bind="text: CurrentItem().Name"></strong> будет удалена.
					<p class="text-danger">
						Также будут удалены все связанные с ней данные:
						<ul>
							<li>Х запросов (и все связанные с ними данные)</li>
							<li><span data-bind="text: CurrentItem().VacancyCount"></span> вакансий (и все связанные с ними данные)</li>
							<li>Х событий</li>
							<li>Х документов</li>
							<li>Х файлов</li>
							<li><span data-bind="text: CurrentItem().JournalCount"></span> записей журнала</li>
						</ul>
					</p>
				</div>
				<footer>
					<button data-bind="click: Close" class="aux" data-dismiss="modal">Отмена</button>
					<button data-bind="click: Done" class="danger">Ok</button>
				</footer>
			</section>
		</div>

		<!-- confirm delete file modal -->
		<div class="modalo" data-bind="allowBindings: false">
			<section id="confirmDeleteFileModalo" style="display:none">
				<header>
					<h3>Подверждение действия</h3>
				</header>
				<div class="content">
					Этот файл будет удален без возможности восстановления.
				</div>
				<footer>
					<button data-bind="click: Close" class="aux">Отмена</button>
					<button data-bind="click: Done" class="danger">Ok</button>
				</footer>
			</section>
		</div>
	</section>

	<!-- scripts -->

	<script src="/Scripts/knockout-3.4.2.debug.js" type="text/javascript"></script>
	<script src="/Scripts/app.js" type="text/javascript"></script>

	<!-- scripts -->

	<script src="/Scripts/knockout.mapping-latest.js" type="text/javascript"></script>
	<script src="/Scripts/Company.js" type="text/javascript"></script>

	<!-- init -->

	<script>
		var init = function () {
			app.ViewModel.PageViewModel = new PageViewModel();
			ko.applyBindings(app.ViewModel, document.getElementById("broot"));
			app.ViewModel.Init();
			test.Init();
		};

		if (document.readyState !== 'loading')
			init();
		else
			document.addEventListener('DOMContentLoaded', init);
	</script>

	<!-- init -->

</body>
</html>
